import { Telegraf } from 'telegraf'
import dotenv from 'dotenv'
import { carregarDados } from './repositories/dadosRepository'
import { registerHandlers } from './handlers'

dotenv.config()

const BOT_TOKEN = process.env.BOT_TOKEN
const DONO_ID = process.env.DONO_ID

if (!BOT_TOKEN) {
  console.error('âŒ BOT_TOKEN nÃ£o configurado no .env')
  process.exit(1)
}

console.log('ðŸš€ Iniciando bot Telegram...')

// Carregar dados
carregarDados()

// Criar instÃ¢ncia do bot
const bot = new Telegraf(BOT_TOKEN)

// Registrar handlers
registerHandlers(bot)

// Iniciar bot
bot.launch()

console.log('âœ… Bot iniciado com sucesso!')
console.log(`ðŸ‘‘ Dono ID: ${DONO_ID}`)

// Graceful shutdown
process.once('SIGINT', () => {
  console.log('ðŸ›‘ Encerrando bot...')
  bot.stop('SIGINT')
  process.exit(0)
})

process.once('SIGTERM', () => {
  console.log('ðŸ›‘ Encerrando bot...')
  bot.stop('SIGTERM')
  process.exit(0)
})